<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>JPG to PDF</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 0;
}

header{
  background: #000000;
  color: white;
  padding: 15px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
footer{
  background: #000000;
  color: white;
  padding: 15px;
  text-align: center;
  position: fixed;
  bottom: 0;  
  width: 100%;
  display: flex;
  align-items: center;  
  justify-content: center;
}


header p , footer p {
    color: #fff;
    text-align: center;
}

header img, footer img {
  height: 40px;
}

header h2, footer p {
  margin: 0;
}

main {
  padding: 40px;
  text-align: center;
}

h1 {
  font-size: 28px;
  margin-bottom: 10px;
}

p {
  color: #555;
  margin-bottom: 20px;
}

.btn {
  background: #e63946;
  color: white;
  border: none;
  padding: 15px 30px;
  font-size: 18px;
  border-radius: 8px;
  cursor: pointer;
  transition: background 0.3s ease;
  margin: 10px;
}

.btn:hover {
  background: #ff4d5a;
}

#downloadLink {
  display: none;
}

.preview {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  margin-top: 30px;
}

.preview-item {
  position: relative;
  display: inline-block;
  cursor: grab;
}

.preview-item.dragging {
  opacity: 0.5;
}

.preview-item img {
  width: 150px;
  height: auto;
  object-fit: cover;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  transition: transform 0.3s;
}

.action-btn {
  position: absolute;
  top: 5px;
  right: 5px;
  background: #e63946;
  border: none;
  color: white;
  border-radius: 50%;
  cursor: pointer;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  transition: background 0.3s ease;
}

.action-btn:hover {
  background: #ff4d5a;
}

.rotate-btn {
  right: 40px;
}

.error-message {
  color: #e63946;
  padding: 10px;
  border-radius: 5px;
  margin-top: 20px;
  display: none;
}

.loader {
  display: none;
  border: 6px solid #f3f3f3;
  border-radius: 50%;
  border-top: 6px solid #e63946;
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 20px auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0; top: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.8);
}

.modal-content {
  position: relative;
  margin: auto;
  padding: 20px;
  width: 90%;
  height: 90%;
  background: white;
  border-radius: 8px;
  overflow: hidden;
}

.modal iframe {
  width: 100%;
  height: 100%;
  border: none;
}

.close {
  position: absolute;
  top: 10px;
  right: 20px;
  color: #333;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
}
</style>
</head>
<body>

<header>
  <img src="https://tools4trade.co.uk/cdn/shop/files/tools4trade-logo_edd395f2-fdd3-497e-9510-a52a021c0aff.png?v=1680089629" alt="Tools4trade Logo">
  <h2>Tools4trade JPG to PDF Converter</h2>
</header>

<main>
<h1>JPG to PDF</h1>
<p>Convert JPG images to PDF. Drag to reorder. Rotate or remove images as needed.</p>

<input type="file" id="imageInput" multiple accept="image/jpeg, image/png" hidden />
<button class="btn" id="selectBtn">Select JPG Images</button>
<button class="btn" id="convertBtn" style="display:none;">Convert to PDF</button>
<button class="btn" id="previewBtn" style="display:none;">Preview PDF</button>
<div class="loader" id="loader"></div>
<a id="downloadLink" download="images.pdf">
  <button class="btn">Download PDF</button>
</a>

<div class="error-message" id="errorMessage"></div>
<div class="preview" id="preview"></div>
</main>

<footer>
  <p>Developed by Tools4trade Mukesh Kumar @ 2025</p>
</footer>

<!-- Modal -->
<div id="pdfModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeModal">&times;</span>
    <iframe id="pdfFrame"></iframe>
  </div>
</div>

<script>
const imageInput = document.getElementById("imageInput");
const selectBtn = document.getElementById("selectBtn");
const convertBtn = document.getElementById("convertBtn");
const previewBtn = document.getElementById("previewBtn");
const downloadLink = document.getElementById("downloadLink");
const preview = document.getElementById("preview");
const errorMessage = document.getElementById("errorMessage");
const loader = document.getElementById("loader");
const pdfModal = document.getElementById("pdfModal");
const pdfFrame = document.getElementById("pdfFrame");
const closeModal = document.getElementById("closeModal");

let selectedFiles = [];
let rotations = [];
let pdfBlobUrl = "";

selectBtn.addEventListener("click", () => {
  errorMessage.style.display = "none";
  preview.innerHTML = "";
  imageInput.value = "";
  imageInput.click();
});

imageInput.addEventListener("change", (e) => {
  preview.innerHTML = "";
  errorMessage.style.display = "none";
  selectedFiles = [];
  rotations = [];

  const files = Array.from(e.target.files);
  const allowedTypes = ["image/jpeg", "image/png", "image/jpg"];
  const invalidFiles = files.filter(file => !allowedTypes.includes(file.type) || file.size === 0);

  if (invalidFiles.length > 0) {
    errorMessage.textContent = "❌ Required a file. Without file you cannot convert.";
    errorMessage.style.display = "block";
    convertBtn.style.display = "none";
    previewBtn.style.display = "none";
    return;
  }

  selectedFiles = files;
  rotations = Array(files.length).fill(0);
  convertBtn.style.display = selectedFiles.length ? "inline-block" : "none";
  previewBtn.style.display = "none";

  selectedFiles.forEach((file, index) => {
    const reader = new FileReader();
    reader.onload = (ev) => {
      const item = document.createElement("div");
      item.className = "preview-item";
      item.draggable = true;
      item.dataset.index = index;

      const img = document.createElement("img");
      img.src = ev.target.result;
      img.dataset.index = index;
      img.style.transform = "rotate(0deg)";

      const removeBtn = document.createElement("button");
      removeBtn.className = "action-btn";
      removeBtn.innerHTML = "✕";
      removeBtn.onclick = () => {
        selectedFiles.splice(index, 1);
        rotations.splice(index, 1);
        preview.removeChild(item);
        updateFileInput();
        if (!selectedFiles.length) convertBtn.style.display = "none";
        previewBtn.style.display = "none";
      };

      const rotateBtn = document.createElement("button");
      rotateBtn.className = "action-btn rotate-btn";
      rotateBtn.innerHTML = "⟳";
      rotateBtn.onclick = () => {
        rotations[index] = (rotations[index] || 0) + 90;
        img.style.transform = `rotate(${rotations[index]}deg)`;
        previewBtn.style.display = "none";
        convertBtn.style.display = "inline-block";
      };

      item.appendChild(img);
      item.appendChild(removeBtn);
      item.appendChild(rotateBtn);
      preview.appendChild(item);

      addDragDrop(item);
    };
    reader.readAsDataURL(file);
  });
});

function updateFileInput() {
  const newFiles = new DataTransfer();
  selectedFiles.forEach(f => newFiles.items.add(f));
  imageInput.files = newFiles.files;
}

function addDragDrop(item) {
  item.addEventListener("dragstart", (e) => {
    item.classList.add("dragging");
    e.dataTransfer.setData("text/plain", item.dataset.index);
  });

  item.addEventListener("dragend", () => {
    item.classList.remove("dragging");
    updateFileOrder();
    previewBtn.style.display = "none";
    convertBtn.style.display = selectedFiles.length ? "inline-block" : "none";
  });

  item.addEventListener("dragover", (e) => {
    e.preventDefault();
    const draggingItem = document.querySelector(".dragging");
    if (draggingItem && draggingItem !== item) {
      const bounding = item.getBoundingClientRect();
      const offset = e.clientX - bounding.left;
      if (offset > bounding.width / 2) {
        item.after(draggingItem);
      } else {
        item.before(draggingItem);
      }
    }
  });
}

function updateFileOrder() {
  const newOrder = [];
  const newRotations = [];
  preview.querySelectorAll(".preview-item").forEach(item => {
    const index = parseInt(item.dataset.index);
    newOrder.push(selectedFiles[index]);
    newRotations.push(rotations[index]);
  });
  selectedFiles = newOrder;
  rotations = newRotations;
  updateFileInput();
}

convertBtn.addEventListener("click", async () => {
  loader.style.display = "block";
  convertBtn.style.display = "none";
  const formData = new FormData();
  selectedFiles.forEach(file => formData.append("images", file));
  formData.append("rotations", JSON.stringify(rotations));

  try {
    const response = await fetch("https://fdf-maker.onrender.com/api/create-pdf", {
      method: "POST",
      body: formData,
    });

    if (!response.ok) throw new Error("Failed to generate PDF");

    const blob = await response.blob();
    pdfBlobUrl = URL.createObjectURL(blob);

    downloadLink.href = pdfBlobUrl;
    downloadLink.style.display = "inline-block";
    previewBtn.style.display = "inline-block";
  } catch (err) {
    errorMessage.textContent = "❌ Error: " + err.message;
    errorMessage.style.display = "block";
  } finally {
    loader.style.display = "none";
  }
});

previewBtn.addEventListener("click", () => {
  pdfFrame.src = pdfBlobUrl;
  pdfModal.style.display = "block";
});

closeModal.addEventListener("click", () => {
  pdfModal.style.display = "none";
});

window.addEventListener("click", (e) => {
  if (e.target == pdfModal) {
    pdfModal.style.display = "none";
  }
});
</script>
</body>
</html>

